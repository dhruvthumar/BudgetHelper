<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#fafafa;--card:#fff;--text:#000;--text2:#666;--text3:#999;--border:#eee;--accent:#000;--green:#00c896;--red:#ff5252}
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.5}
        .nav{background:var(--card);border-bottom:1px solid var(--border);padding:1rem;position:sticky;top:0;z-index:100}
        .nav-inner{max-width:800px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
        .logo{font-weight:600;font-size:1.1rem}
        .nav-right{display:flex;gap:.5rem;align-items:center}
        select,input,button{font:inherit}
        .sel{padding:.4rem .6rem;border:1px solid var(--border);border-radius:6px;background:var(--card)}
        .btn-icon{width:36px;height:36px;border:1px solid var(--border);border-radius:6px;background:var(--card);cursor:pointer;font-size:1.1rem}
        .main{max-width:800px;margin:0 auto;padding:1.5rem 1rem}
        .balance{background:var(--card);border-radius:12px;padding:2rem;text-align:center;margin-bottom:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,.04)}
        .balance-label{font-size:.75rem;color:var(--text3);text-transform:uppercase;letter-spacing:.05em}
        .balance-amount{font-size:2.5rem;font-weight:600;margin:.5rem 0 1rem}
        .balance-row{display:flex;justify-content:center;gap:2rem}
        .balance-item{text-align:center}
        .balance-item span{display:block}
        .balance-item .label{font-size:.7rem;color:var(--text3);text-transform:uppercase}
        .balance-item .value{font-size:1.1rem;font-weight:600}
        .income{color:var(--green)}
        .expense{color:var(--red)}
        .add-btn{display:flex;align-items:center;justify-content:center;gap:.5rem;margin:0 auto 1.5rem;padding:.6rem 1.2rem;background:var(--accent);color:#fff;border:none;border-radius:50px;cursor:pointer;font-weight:500;font-size:.875rem}
        .add-btn:hover{opacity:.9}
        .form-card{background:var(--card);border-radius:12px;padding:1rem;margin-bottom:1.5rem;display:none}
        .form-card.show{display:block}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
        .form-grid input,.form-grid select{padding:.6rem;border:1px solid var(--border);border-radius:6px;width:100%}
        .form-actions{grid-column:span 2;display:flex;gap:.5rem;justify-content:flex-end;margin-top:.5rem}
        .btn{padding:.5rem 1rem;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:.875rem}
        .btn-p{background:var(--accent);color:#fff}
        .btn-s{background:transparent;border:1px solid var(--border)}
        .section{background:var(--card);border-radius:12px;padding:1rem;margin-bottom:1rem;box-shadow:0 1px 3px rgba(0,0,0,.04)}
        .section-title{font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--text2);margin-bottom:1rem}
        .charts{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
        .chart-box{background:var(--card);border-radius:12px;padding:1rem;box-shadow:0 1px 3px rgba(0,0,0,.04)}
        .chart-wrap{height:180px;position:relative}
        .budget-item{padding:.75rem;background:var(--bg);border-radius:8px;margin-bottom:.5rem}
        .budget-item:last-child{margin-bottom:0}
        .budget-head{display:flex;justify-content:space-between;font-size:.8rem;margin-bottom:.4rem}
        .budget-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden}
        .budget-fill{height:100%;background:var(--accent);border-radius:2px}
        .budget-fill.warn{background:#ffb700}
        .budget-fill.over{background:var(--red)}
        .trans-item{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid var(--border)}
        .trans-item:last-child{border-bottom:none}
        .trans-left{flex:1}
        .trans-desc{font-size:.875rem;font-weight:500}
        .trans-meta{font-size:.7rem;color:var(--text3);display:flex;gap:.5rem;align-items:center;margin-top:.2rem}
        .trans-cat{background:var(--bg);padding:.1rem .4rem;border-radius:3px;font-size:.65rem;text-transform:uppercase}
        .trans-right{display:flex;align-items:center;gap:.75rem}
        .trans-amt{font-weight:600;font-size:.875rem}
        .del-btn{opacity:0;background:none;border:none;color:var(--text3);cursor:pointer;padding:.25rem;font-size:1rem}
        .trans-item:hover .del-btn{opacity:1}
        .del-btn:hover{color:var(--red)}
        .empty{text-align:center;color:var(--text3);padding:2rem;font-size:.875rem}
        .loading{text-align:center;padding:2rem}
        .spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;margin:0 auto}
        @keyframes spin{to{transform:rotate(360deg)}}
        .modal{display:none;position:fixed;inset:0;z-index:1000}
        .modal.show{display:block}
        .modal-bg{position:absolute;inset:0;background:rgba(0,0,0,.5)}
        .modal-box{position:relative;max-width:400px;margin:10vh auto;background:var(--card);border-radius:12px;max-height:80vh;overflow:auto}
        .modal-head{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid var(--border)}
        .modal-head h2{font-size:1rem}
        .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text3)}
        .modal-body{padding:1rem}
        .modal-foot{padding:1rem;border-top:1px solid var(--border);text-align:right}
        .set-group{margin-bottom:1.25rem}
        .set-label{font-size:.8rem;font-weight:500;margin-bottom:.4rem;display:block}
        .set-input{width:100%;padding:.6rem;border:1px solid var(--border);border-radius:6px}
        .set-help{font-size:.7rem;color:var(--text3);margin-top:.3rem}
        .cat-item{display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:var(--bg);border-radius:6px;margin-bottom:.5rem}
        .cat-input{width:80px;padding:.4rem;border:1px solid var(--border);border-radius:4px;text-align:right}
        .toast{position:fixed;bottom:1rem;right:1rem;padding:.6rem 1rem;background:var(--accent);color:#fff;border-radius:6px;font-size:.875rem;z-index:2000;animation:slideIn .3s}
        .toast.ok{background:var(--green)}
        .toast.err{background:var(--red)}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        @media(max-width:600px){.charts{grid-template-columns:1fr}.form-grid{grid-template-columns:1fr}.form-actions{grid-column:span 1}.balance-amount{font-size:2rem}.del-btn{opacity:1}}
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-inner">
            <div class="logo">◐ Budget</div>
            <div class="nav-right">
                <select id="month" class="sel"></select>
                <select id="year" class="sel"></select>
                <button id="settingsBtn" class="btn-icon">⚙</button>
            </div>
        </div>
    </nav>

    <main class="main">
        <div class="balance">
            <div class="balance-label">Balance</div>
            <div class="balance-amount" id="balance">$0.00</div>
            <div class="balance-row">
                <div class="balance-item">
                    <span class="label">Income</span>
                    <span class="value income" id="income">+$0</span>
                </div>
                <div class="balance-item">
                    <span class="label">Expenses</span>
                    <span class="value expense" id="expenses">-$0</span>
                </div>
            </div>
        </div>

        <button class="add-btn" id="addBtn">+ Add Transaction</button>

        <div class="form-card" id="formCard">
            <form id="txForm" class="form-grid">
                <input type="date" id="txDate" required>
                <input type="text" id="txDesc" placeholder="Description" required>
                <select id="txCat" required><option value="">Category</option></select>
                <input type="number" id="txAmt" placeholder="0.00" step="0.01" required>
                <select id="txType"><option value="Expense">Expense</option><option value="Income">Income</option></select>
                <div class="form-actions">
                    <button type="button" class="btn btn-s" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn btn-p">Save</button>
                </div>
            </form>
        </div>

        <div class="charts">
            <div class="chart-box">
                <div class="section-title">By Category</div>
                <div class="chart-wrap"><canvas id="catChart"></canvas></div>
            </div>
            <div class="chart-box">
                <div class="section-title">Daily Trend</div>
                <div class="chart-wrap"><canvas id="dayChart"></canvas></div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Budgets</div>
            <div id="budgets"><div class="loading"><div class="spinner"></div></div></div>
        </div>

        <div class="section">
            <div class="section-title">Recent</div>
            <div id="transactions"><div class="loading"><div class="spinner"></div></div></div>
        </div>
    </main>

    <div class="modal" id="modal">
        <div class="modal-bg" id="modalBg"></div>
        <div class="modal-box">
            <div class="modal-head">
                <h2>Settings</h2>
                <button class="modal-close" id="modalClose">×</button>
            </div>
            <div class="modal-body">
                <div class="set-group">
                    <label class="set-label">Google Script URL</label>
                    <input type="text" id="apiUrl" class="set-input" placeholder="https://script.google.com/macros/s/AKfycbxXB1lzyifEU1KhkoYI5jxZsLeSNoMRFma4tjHEw1zIPs6A1WtdInlQbCmrESf4T_GV/exec">
                    <p class="set-help">Your deployed Google Apps Script Web App URL</p>
                </div>
                <div class="set-group">
                    <label class="set-label">Category Budgets</label>
                    <div id="catList"></div>
                </div>
            </div>
            <div class="modal-foot">
                <button class="btn btn-p" id="saveSettings">Save</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>